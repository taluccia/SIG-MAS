---
title: "TreeMap"
author: "Anna Talucci"
date: "10/5/2023"
output: html_document
---

# Overview
Create exterior boundary for SN and NC HUCS.

# Packages
```{r}
library(tidyverse)
library(sf)
library(raster)
library(rgdal)
library(terra)
```

# Data

## States
```{r}
states = st_read("../data/State_boundaries/tl_2022_us_state.shp", "tl_2022_us_state")
```
### Select States
```{r}
(
  states_aoi = states %>% filter(NAME =="California")
)
```


## HUC12
```{r}
hucs = st_read("../data/TxHucs/TxPrctRankRrkWipRffc.shp", "TxPrctRankRrkWipRffc")
```

```{r}
tm = raster("../data/treeMap/TreeMap2016.tif")
tm
```

```{r}
r = rast("../data/treeMap/TreeMap2016.tif")
r
```

```{r}
crs(tm)
```

```{r}
tm
```

```{r}
proj = "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m+no_defs"
```

```{r}
ca = st_transform(states_aoi, crs = "+proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs")
```

```{r}
st_crs(ca)
```
# Clip tree map to CA
```{r}
treemap_AOI <- crop(tm, extent(ca))
treemap_project <- mask(treemap_AOI, ca)
```

```{r}
r_AOI <- crop(r, extent(ca))
```

```{r}
str(treemap_project)
treemap_AOI
```
```{r eval=FALSE, include=FALSE}
cats(tm)
```

```{r}
treemap_project
```
```{r}
canopy <- (getValues(treemap_project@CANOPYPCT))
```



```{r}
canopy <- deratify(r_AOI, "CANOPYPCT")
canopy
```



```{r}
plot(canopy)
```




```{r}
writeRaster(canopy, '../outputs/TreeMap2016Canopy.tif')
```
